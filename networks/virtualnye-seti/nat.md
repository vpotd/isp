# NAT

**NAT** \(от англ. _Network Address Translation_ — «преобразование сетевых адресов»\) — это механизм в сетях TCP/IP, позволяющий преобразовывать IP-адреса транзитных пакетов

### Функции NAT: <a id="NAT.&#x41E;&#x441;&#x43D;&#x43E;&#x432;&#x43D;&#x44B;&#x435;&#x43F;&#x43E;&#x43D;&#x44F;&#x442;&#x438;&#x44F;.&#x41F;&#x440;&#x438;&#x43D;&#x446;&#x438;&#x43F;&#x440;&#x430;&#x431;&#x43E;&#x442;&#x44B;-&#x424;&#x443;&#x43D;&#x43A;&#x446;&#x438;&#x438;NAT:"></a>

1. **Позволяет сэкономить IP-адреса** \(только в случае использования NAT в режиме PAT\), транслируя несколько внутренних IP-адресов в один внешний публичный IP-адрес \(или в несколько, но меньшим количеством, чем внутренних\). По такому принципу построено большинство сетей в мире: на небольшой район домашней сети местного провайдера или на офис выделяется 1 публичный \(внешний\) IP-адрес, за которым работают и получают доступ интерфейсы с приватными \(внутренними\) IP-адресами.
2. **Позволяет предотвратить или ограничить обращение снаружи ко внутренним хостам, оставляя возможность обращения изнутри наружу**. При инициации соединения изнутри сети создаётся трансляция. Ответные пакеты, поступающие снаружи, соответствуют созданной трансляции и поэтому пропускаются. Если для пакетов, поступающих снаружи, соответствующей трансляции не существует \(а она может быть созданной при инициации соединения или статической\), они не пропускаются.
3. **Позволяет скрыть определённые внутренние сервисы внутренних хостов/серверов**. По сути, выполняется та же указанная выше трансляция на определённый порт, но возможно подменить внутренний порт официально зарегистрированной службы \(например, 80-й порт TCP \(HTTP-сервер\) на внешний 54055-й\). Тем самым, снаружи, на внешнем IP-адресе после трансляции адресов на сайт \(или форум\) для осведомлённых посетителей можно будет попасть по адресу [http://example.org:54055](http://example.org:54055/), но на внутреннем сервере, находящемся за NAT, он будет работать на обычном 80-м порту. Повышение безопасности и скрытие «непубличных» ресурсов.

### Принцип работы <a id="NAT.&#x41E;&#x441;&#x43D;&#x43E;&#x432;&#x43D;&#x44B;&#x435;&#x43F;&#x43E;&#x43D;&#x44F;&#x442;&#x438;&#x44F;.&#x41F;&#x440;&#x438;&#x43D;&#x446;&#x438;&#x43F;&#x440;&#x430;&#x431;&#x43E;&#x442;&#x44B;-&#x41F;&#x440;&#x438;&#x43D;&#x446;&#x438;&#x43F;&#x440;&#x430;&#x431;&#x43E;&#x442;&#x44B;"></a>

Преобразование адреса методом NAT может производиться почти любым маршрутизирующим устройством — маршрутизатором, сервером доступа, межсетевым экраном. Наиболее популярным является SNAT, суть механизма которого состоит в замене адреса источника \(англ. _source_\) при прохождении пакета в одну сторону и обратной замене адреса назначения \(англ. _destination_\) в ответном пакете. Наряду с адресами источник/назначение могут также заменяться номера портов источника и назначения.

Принимая пакет от локального компьютера, роутер смотрит на IP-адрес назначения. Если это локальный адрес, то пакет пересылается другому локальному компьютеру. Если нет, то пакет надо переслать наружу в интернет. Однако, обратным адресом в пакете указан локальный адрес компьютера, который из интернета будет недоступен. Поэтому роутер «на лету» транслирует \(подменяет\) обратный IP-адрес пакета на свой внешний \(видимый из интернета\) IP-адрес и меняет номер порта \(чтобы различать ответные пакеты, адресованные разным локальным компьютерам\). Комбинацию, нужную для обратной подстановки, роутер сохраняет у себя во временной таблице. Через некоторое время после того, как клиент и сервер закончат обмениваться пакетами, роутер сотрет у себя в таблице запись о n-ом порте за сроком давности.

Помимо source NAT \(предоставления пользователям локальной сети с внутренними адресами доступа к сети Интернет\) часто применяется также destination NAT, когда обращения извне транслируются межсетевым экраном на компьютер пользователя в локальной сети, имеющий внутренний адрес и потому недоступный извне сети непосредственно \(без NAT\).

### Варианты NAT <a id="NAT.&#x41E;&#x441;&#x43D;&#x43E;&#x432;&#x43D;&#x44B;&#x435;&#x43F;&#x43E;&#x43D;&#x44F;&#x442;&#x438;&#x44F;.&#x41F;&#x440;&#x438;&#x43D;&#x446;&#x438;&#x43F;&#x440;&#x430;&#x431;&#x43E;&#x442;&#x44B;-&#x412;&#x430;&#x440;&#x438;&#x430;&#x43D;&#x442;&#x44B;NAT"></a>

**Статический NAT** — трансляция серого IP-адреса на белый IP-адрес на основании один к одному.

**Динамический NAT** — транслирует серый IP-адрес на белый из пула белых IP-адресов. Динамический NAT также устанавливает непосредственное преобразование между серым и белым IP-адресом, но преобразование может меняться в зависимости от белого IP-адреса, доступного в пуле адресов, во время коммуникации.

**Перегруженный NAT** \(NAPT, NAT Overload, PAT, маскарадинг\) — форма динамического NAT, который транслирует несколько серых адресов в единственный белый IP-адрес, используя различные порты. Известен также как PAT \(Port Address Translation\). В таком варианте каждый компьютер в частной сети транслируется в тот же самый адрес, но с различным номером порта.

Механизм NAT определён в [RFC 1631](https://tools.ietf.org/html/rfc1631), [RFC 3022](https://tools.ietf.org/html/rfc3022).

